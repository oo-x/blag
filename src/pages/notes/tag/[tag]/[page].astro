---
import { collateTags } from '@/util/content'
import MainLayout from '@/layouts/main.astro'
import Nav from '@/components/Nav.astro'
import NoteTile from '@/components/NoteTile.astro'
import Pagination from '@/components/Pagination.astro'

import type { Page, GetStaticPathsOptions } from 'astro'
import type { CollectionEntry } from 'astro:content'

type Note = CollectionEntry<'notes'>
type Props = { page: Page<Note> }

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
	const tagMap = await collateTags<Note[]>((n, ns) => [...(ns ?? []), n])
	return [...tagMap].flatMap(([tag, notes]) => {
		return paginate(notes, {
			pageSize: 10,
			params: { tag },
		})
	})
}

const { tag } = Astro.params
const { page } = Astro.props
---

<MainLayout title={`Blag - Tag: ${tag}`}>
	<Nav />
	<main class="mx-auto max-w-6xl px-4 py-8">
		<div class="mb-6 px-6 md:px-0">
			<h1 class="mb-3 text-4xl font-bold tracking-tight">{tag}</h1>
			<p class="text-lg text-muted-foreground">Notes tagged with {tag}</p>
		</div>

		<div class="grid gap-4">
			{page.data.map((note) => <NoteTile note={note} />)}
		</div>

		<Pagination page={page} />
	</main>
</MainLayout>
