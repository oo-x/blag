---
import { getCollection, render } from 'astro:content'
import MainLayout from '@/layouts/main.astro'
import Nav from '@/components/Nav.astro'
import TagList from '@/components/TagList.astro'
import FormattedDate from '@/components/FormattedDate.astro'
import ArrowLeft from '@/assets/arrow-left.svg'

import type { CollectionEntry } from 'astro:content'

type Props = CollectionEntry<'notes'>

export async function getStaticPaths() {
	const notes = await getCollection('notes')
	return notes.map((props) => ({ params: { slug: props.id }, props }))
}

const note = Astro.props
const { Content } = await render(note)
---

<MainLayout title={note.data.title}>
	<Nav />
	<main class="mx-auto max-w-3xl px-4 py-8 md:px-6 lg:px-8">
		<article>
			<header class="mb-8 border-b border-border pb-8">
				<a
					href="/notes"
					class="group mb-6 inline-flex items-center text-sm text-muted-foreground hover:text-primary"
				>
					<ArrowLeft class="mr-2 transition-transform group-hover:-translate-x-1" />
					Back to notes
				</a>

				<h1 class="mb-4 text-4xl font-bold tracking-tight">{note.data.title}</h1>

				<div class="flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
					<FormattedDate date={note.data.created} />

					{note.data.updated && (
						<span>Updated: <FormattedDate date={note.data.updated} /></span>
					)}

					<TagList link tags={note.data.tags} />
				</div>
			</header>

			<div class="prose prose-lg max-w-none dark:prose-invert prose-headings:font-semibold prose-headings:tracking-tight prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-code:text-primary prose-pre:border prose-pre:border-border prose-pre:bg-muted prose-img:rounded-lg">
				<Content />
			</div>
		</article>
	</main>
</MainLayout>
